# 内存分配函数

## 概述
通常，变量的内存由系统自动分配。也可以使用以下函数在动态内存（堆）中分配变量。这些函数类似于 C++ 的 `new` 和 `delete` 运算符，可用于分配和释放任意类型变量的内存，包括复合类型（如 `str`、`VARIANT`）及具有构造函数/析构函数的类型。另见 [DLL 函数](../User/IDP_QMDLL.html)、[str 变量](../str/IDP_S_ALL.html)、[安全数组](../_COM/IDP_OLE_ARRAY.html)。

## 语法
```
p._new([count])
p._resize([count])
p._delete
int p._len
```

## 参数
- **p** - 任意类型的指针变量。
- **count** - 元素数量：
  - `_new`：默认 1。
  - `_resize`：默认增加 1，可为负数以增加 `-count` 个元素。

## 备注
- **_new**：为 **p** 的类型分配单个变量或数组的内存，所有字节置 0。若类型有构造函数，则为每个元素调用。设置 **p** 指向首个元素，返回 **p** 的引用。内存不再需要时，需用 `_delete` 释放，不释放先前分配的内存。
- **_resize**：调整内存以容纳更多或更少元素，保留全部或部分原有内容。若 **count** 大于原元素数，新增内存按 `_new` 方式初始化；若小于，删除的元素按 `_delete` 方式释放。**p** 须指向 `_new` 或 `_resize` 分配的内存，或为 0。设置 **p** 指向调整后的（可能移动的）内存块首个元素，返回 **p** 的引用。
- **_delete**：释放内存并将 **p** 置 0。若类型有析构函数，则为每个元素调用，`str` 等复合类型元素也会被正确清理。**p** 须指向 `_new` 或 `_resize` 分配的内存，或为 0。返回 **p** 的引用。
- **_len**：返回数组元素数量，**p** 须指向 `_new` 或 `_resize` 分配的内存，或为 0。
- 使用这些函数分配的内存不会在指针变量销毁时自动释放，需显式调用 `_delete`。
- 使用这些函数的指针变量不可与其他内存分配函数混用，反之亦然。

## 示例
```cpp
str* p._new(10)
out p._len ;;10
p._resize(20)
out p._len ;;20
p._delete

MyClass* c._new
// ...
c._delete
```