# 运算符

运算符是用于执行赋值、算术、比较或其他操作的特殊符号。本文档列出二元运算符（即用于两个操作数的运算符，如 `a + b`）。另见：[一元运算符](IDP_OPUNARY.md)（用于单个操作数）、[成员访问运算符](IDP_TYPEUSAGE.md) `.` 和 [数组元素访问运算符](IDP_OLE_ARRAY.md) `[]`。

## 语法

### 语法 1

```qm
result = operand1 operator operand2
```

例如，`a = b + 1` 表示“将 b 和 1 相加，结果赋值给 a”。其中，`b` 是 **operand1**，`+` 是 **operator**，`1` 是 **operand2**。

### 语法 2

```qm
operand1 operator operand2
```

**operand1** 接收结果。例如，`a + 1` 表示“将 1 加到 a”（等同于 `a = a + 1`）。

## 参数

- **operands** - 任何 [表达式](IDP_EXPRESSION.md)（变量、常量、函数、带运算符的表达式）。
- **operator** - 以下列出的符号之一。

## 赋值运算符

使用 `=` 将值赋给变量。例如：

```qm
a = 1
```

在 `if` 或其他赋值中使用 `=` 时，它被解释为比较运算符（见下文）。

## 算术和位运算符

### 算术运算符

| 运算符 | 描述 |
|--------|------|
| `+` | 加法。例如：`a = b + 1` |
| `-` | 减法 |
| `*` | 乘法 |
| `/` | 除法 |
| `%` | 取模 |

### 位运算符

| 运算符 | 描述 |
|--------|------|
| `&` | 按位与 |
| `|` | 按位或 |
| `^` | 按位异或 |
| `~` | 按位与非 |
| `<<` | 左移 |
| `>>` | 右移（无符号） |

所有算术和位运算符的 [优先级](IDP_OPPRIORITY.md) 相同。例如，在 `a = b + c * d` 中，先计算 `b + c`，再乘以 `d`。

## 比较运算符

| 运算符 | 描述 |
|--------|------|
| `=` 或 `==` | 相等。例如：`if(a = 5) out "a is 5"` |
| `!` 或 `!=` 或 `<>` | 不等 |
| `>` | 大于 |
| `>=` | 大于或等于 |
| `<` | 小于 |
| `<=` | 小于或等于 |

比较运算符的优先级低于算术和位运算符。例如，在 `if(a < b + c)` 中，先计算 `b + c`，再与 `a` 比较。比较结果为 1（真）或 0（假）。

## 逻辑运算符

| 运算符 | 描述 |
|--------|------|
| `and` 或 `&&` | 逻辑与。例如：`if(a = b and c < d) out "a is equal to b, and c is less than d"` |
| `or` 或 `||` | 逻辑或 |

逻辑运算符的优先级低于算术、位和比较运算符。例如，在 `if(a > b and c != d)` 中，先比较 `a > b` 和 `c != d`。

逻辑运算符结果为 1 或 0。`and` 在两个操作数非 0 时返回 1，若 **operand1** 为 0，则不计算 **operand2**。`or` 在任一操作数非 0 时返回 1，若 **operand1** 非 0，则不计算 **operand2**。

## 用于字符串变量的运算符

### 比较运算符

| 运算符 | 描述 |
|--------|------|
| `=` | 相等，区分大小写。例如：`if(s = "abc") out "s is 'abc'"` |
| `!` | 不等，区分大小写 |
| `~` | 相等，不区分大小写 |

**注意**：`""` 和 `null` 不相等。不要使用 `if(s = "")` 检查字符串是否为空，应使用 `if(empty(s))` 或 `if(!s.len)`。另见：[empty](IDP_EMPTY.md)、[StrCompare](IDP_QMDLL.md#StrCompare)。

### 连接运算符（语法 2）

| 运算符 | 描述 |
|--------|------|
| `+` | 追加。例如：`str s; s="notepad"; s+".exe"` |
| `-` | 前置追加 |

`+` 和 `-` 不用于语法 1 连接字符串。代替 `s1 = s2 + s3`，使用 `s1.from(s2 s3)` 或 `s1=F"{s2}{s3}"`。

**另见**：[字符串](IDH_STRINGS.md)

## 说明

- 只有赋值运算符可用于所有变量类型。其他运算符适用于 QM 内置类型（`int`、`byte`、`word`、`long`、`double`、`str`、`lpstr`）。对于其他类型，某些运算符可能不可用或结果不符合预期，建议转换为所需内置类型。例如：

```qm
BSTR b="xx"; str s=b; if(s="xx") ;; 不要使用 if(b="xx")
```

### 语法 1

`str` 类型操作数被解释为 `lpstr`，除非使用字符串比较运算符 `=`、`!`、`~`。`lpstr` 和指针被解释为数值（无符号 `int`）。例如，`if(s1 = s2)` 比较指针而非字符串内容；`s1 = s2 + 1` 将 `s1` 设为 `s2` 第二个字符的地址（如 `s2` 为 `"tree"`，`s1` 将为 `"ree"`）。

### 语法 2

像 C/C++ 一样，算术和位运算符可后接 `=`，例如：`a += 1`。

**另见**：
- [运算符优先级](IDP_OPPRIORITY.md)
- [表达式类型和精度](IDP_OPTYPE.md)
- [C 运行时库](IDP_OPCRT.md)
- [变量转换等](IDP_VARTABLE.md)

## 示例

```qm
i = 5 ;; 将 5 赋值给变量 i
i + 2 ;; 将 2 加到变量 i
a = b + 10 ;; 计算 b 和 10 的和，赋值给变量 a
a + b + 10 ;; 计算 b 和 10 的和，加到变量 a
int j = i + 2 ;; 声明并赋值
ave = i + j / 2 ;; 将 j 除以 2 加到 i，赋值给变量 ave
f = i - (10 * j) + Func(a b) * 10 ;; 10 乘以 j，从 i 减去，调用 Func 加其返回值，乘以 10，赋值给 f
str s = "notepad" ;; 声明变量 s 并赋值 "notepad"
s + ".exe" ;; 追加 ".exe"
if(i < 10 and s = "notepad.exe") i + j / 10 ;; 若 i 小于 10 且 s 等于 "notepad.exe"，计算 j / 10 并赋值给 i
i = Func2(j s (i + 5) f) ;; 调用 Func2，传递四个参数（包括 i + 5），将其返回值赋值给 i
lef a-10 100 ;; 左键单击；x 为 a-10，y 为 100
```