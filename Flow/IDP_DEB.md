# 设置调试模式

> **注意**: 在 [exe](IDH_MAKEEXE.md) 中不可用。

## 语法

```qm
deb[+|-] [speedMS]
```

## 参数

- **speedMS** - 在执行语句前等待的时间（毫秒）。默认值：-1（无限）。

## 选项

| 选项 | 描述 |
|------|------|
| 默认 | 启动调试/单步模式。 |
| + (QM 2.3.1) | 启动调试模式并运行到断点，然后进入单步模式。 |
| - | 结束单步模式并运行到断点。不启动/结束调试模式。不使用 **speedMS**。 |

## 说明

为当前 [线程](IDP_THREADS.md)（正在运行的宏）设置调试模式。

您也可以通过“调试”菜单以调试模式运行当前宏，此时无需使用 `deb`。

在调试模式下，您可以逐语句执行，查看变量等。在线程以调试模式运行时，工具栏会添加几个按钮，并可选显示调试窗口。

在调试模式下，线程可以处于单步模式或非单步模式。在单步模式下，线程在每条语句前等待 **speedMS** 毫秒。如果省略 **speedMS** 或为 -1，则等待用户点击“调试”菜单项或工具栏按钮。

`deb` 设置单步模式。`deb-` 结束单步模式。`deb+` 也结束单步模式。还可以通过断点或“调试”菜单 -> 选项 -> 在错误时中断来设置单步模式。详情见下文。也可以通过“调试”菜单/工具栏项启动/结束单步模式。利用这些功能，您可以让宏的某些部分在单步模式下执行，其他部分不在单步模式下执行。

未展开文件夹中的语句不会以单步模式执行。这使得调试更简单，因为会跳过系统函数和其他低级函数，除非您展开函数所在文件夹（或使用“步入”按钮）。

### 菜单/工具栏项

- **单步 (Step)** - 执行标有黄色箭头的语句，并停在下一条语句。然后用绿色标记已执行的语句。如果语句调用用户定义的函数，会打开该函数。跳过未在展开文件夹中的函数。
- **步入 (Step Into)** - 与单步相同，但不跳过未在展开文件夹中的函数。
- **步出 (Step Out)** - 以非单步模式继续运行，但在函数返回时停止。通常停在调用者函数的下一条语句。
- **运行到光标 (Run to Cursor)** - 以非单步模式运行（或继续）宏，但在包含文本光标（插入符）的语句处停止（进入单步模式）。也会在断点处停止。
- **运行到断点 (Run to Breakpoint)** - 以非单步模式运行（或继续）宏，直到遇到断点或结束。与 `deb+` 或 `deb-` 相同。
- **结束 (End)** - 结束正在调试的线程，并关闭调试模式。

如果 **speedMS** >= 0，线程在每条语句前至少等待 **speedMS** 毫秒。

在等待执行语句时，线程并未完全阻塞，允许调用回调函数、处理对话框消息、COM 事件等。这些回调函数即使调用 `deb` 或包含断点，也不会以单步模式运行。

您还可以使用断点。通过中键点击选择栏或使用“调试”菜单添加/删除断点。断点在选择栏中以棕色圆圈标记。断点类似于 `deb`，但仅在调试模式下激活（即宏先执行了 `deb` 或 `deb+`，或从“调试”菜单启动）。关闭宏或退出 QM 时，断点会消失。

不应在某些流程控制语句（例如 `err`、空的 `case` 等）上设置断点，因为可能不会按预期工作。在运行时不执行的行（注释、声明、指令等）上的断点会在下一条语句处中断。

在调试模式下，调试快捷键（F5 等）会临时注册为全局快捷键，无论 QM 是否激活均有效。快捷键 F5（单步）、Ctrl+F5（运行到断点）和 Shift+F5（运行到光标）在 QM 窗口中始终可用。例如，您可以按 F5 以调试单步模式运行当前宏，或按 Ctrl+F5 以调试模式运行并在第一个断点处停止。

在“调试”菜单 -> 选项中可以设置调试模式下的某些选项。如果选中“中断”，则在运行时错误时停止（进入单步模式）。如果选中“显示”，则在 QM 输出中显示 [已处理](IDP_ERR.md) 的错误。

如果“调试”菜单 -> 选项 -> 显示调试窗口被选中，QM 会在启动调试模式时显示调试窗口。详情见下文。

## 提示

您可以在宏的多个位置放置 `deb`，以不同速度调试宏的某些部分，或打开/关闭单步模式。

如果