# 创建、修改、复制和删除 QM 项目

> **注意**：在 [可执行文件](IDH_MAKEEXE.md) 中不可用。

## 语法

```qm
int newitem([name] [text] [type|template] [trigger] [folder] [flags])
```

## 参数

- **name** - 项目名称。
  - 也可以是现有项目的 [ID](IDP_QMITEM.md)（整数，例如用于删除或替换时）。
  - 如果包含无效文件名字符或对函数/成员函数无效，报错。
  - 如果为 `""`，使用类型或模板的名称。
- **text** - 项目文本。
  - 对于文件链接项目，为文件路径。
  - 如果为 `""`，复制模板的文本。
- **type** - [QM 项目类型](IDH_ITEMS.md)。可选值：`"Macro"`、`"Function"`、`"Menu"`、`"Toolbar"`、`"Autotext"`、`"Member"`、`"Folder"`、`"File Link"`。
  - 如果省略或为 `""`，创建宏。
  - 为了兼容 QM 2.3.5 之前的版本，`"Autotext"` 可用 `"T.S. Menu"` 或 `"TS Menu"` 替代。
- **template** - 现有项目的名称或 ID，其类型和其他属性将应用于新项目。
  - 不得为文件夹。QM 2.3.3 起：如果使用 ID，可以是文件夹。
  - QM 2.3.3 起：可以是文件链接。
- **trigger** - [编码的触发器字符串](IDP_TRIGGER_CODING.md)。
  - QM 2.4.0 起：如果省略或为 `""`，复制模板的触发器。
  - QM 2.3.3 起：可用于文件夹，设置作用域（程序）。例如：`"/IEXPLORE,FIREFOX"`。
- **folder** - 创建新项目的文件夹名称或 ID。
  - 如果文件夹不存在，也会创建文件夹。
  - 可为完整路径，例如 `"\Folder\Subfolder"`。
  - 如果省略或为 `""`，不创建在文件夹中。
- **[flags](IDP_FLAGS.md)**：
  | 标志 | 描述 |
  |------|------|
  | 0 | 如果 **name** 已存在，创建具有唯一名称的新项目（例如 `"Macro"` → `"Macro2"`）。<br>- 标志 0-3 不可同时使用。<br>- QM 2.3.3 起：如果是文件夹，不生成唯一名称。 |
  | 1 | 如果 **name** 已存在，替换它。<br>- 不可替换文件夹。 |
  | 2 | 如果 **name** 已存在，报错。 |
  | 3 | 如果 **name** 已存在，仅替换其文本。<br>- 如果项目当前打开（在“打开项目”列表中），用户可撤销。<br>- 不替换其他属性。<br>- 或者可使用 [str.setmacro](IDP_S_MACROS.md)。 |
  | 4 | 选择新项目。 |
  | 8 | 允许用户编辑新项目名称（需与标志 4 一起使用，且 QM 窗口处于激活状态）。 |
  | 16 | 在底部创建项目。 |
  | 32 | 删除项目。<br>- 除标志 64 外，其他标志、**text** 和 **trigger** 不使用。<br>- 如果项目不存在，不报错，返回 -1。 |
  | 64 | 删除时需确认（与标志 32 一起使用）。用户点击取消时报错。 |
  | 128 (QM 2.3.0) | 临时项目。临时项目在关闭文件时消失。<br>- QM 2.4.0 起：无论 **folder** 如何，均创建在 Temp 文件夹中。 |

## 说明

创建新的 [QM 项目](IDH_ITEMS.md)，或替换、修改、删除现有项目。返回项目的 [ID](IDP_QMITEM.md)。

不可在只读文件夹中创建、替换、修改或删除项目。使用标志 1（替换）、3（修改）或 32（删除）时，除非使用项目 ID，否则不能操作位于其他文件夹或具有不同类型的现有项目。

QM 2.2.0 起：支持加密模板，新项目也将加密。也可替换（标志 1）、替换文本（标志 3）或删除（标志 32）加密项目。如果使用标志 3 且项目已存在，该项目也必须是加密的。

## 示例

```qm
;; 执行存储在文件 "test.txt" 中的 QM 宏代码。创建一个临时宏，内容为文件文本，并执行：
str s.getfile("$desktop$\test.txt")
mac newitem("temp_file_text" s "" "" "\Temp\files" 1)
```