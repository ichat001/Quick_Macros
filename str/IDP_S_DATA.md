# str 属性 (lpstr, len, nc, flags)

## str 成员变量

- **lpstr** - 指向字符串的指针。
  - 字符串存储在自动分配/释放的字符串缓冲区（内存块）中。
  - **lpstr** 是字符串第一个字符的地址。
  - 如果未分配缓冲区，**lpstr** 为 0。
- **len** - 字符串长度（字节数），不包括[终止空字符](IDH_STRINGS.md)。
- **nc** - 字符串缓冲区的大小。
  - 它是分配的字节数，不包括终止空字符。
  - 为避免频繁重新分配（这会降低性能），str 变量可能分配比字符串所需更多的内存。此时 **nc** 大于 **len**，差值称为*额外字节*。
- **[flags](../Other/IDP_FLAGS.md)**：
  | 值 | 描述 |
  |----|------|
  | 1 (优化) | str 函数永不释放额外字节。这意味着分配的字符串内存可以增长但不会缩小。使用此标志可避免频繁重新分配。但某些函数可能忽略此标志。 |
  | 2 (优化) | str 函数应分配更多额外字节以避免频繁重新分配。 |
  | 4 (安全) | QM 2.3.3。在释放字符串内存前擦除内存。用于密码和其他敏感数据，使从内存中恢复字符串变得更困难。可使用以下代码设置此标志：`str s; s.__set_secure`。在旧版 QM 中需显式擦除：`str s="password"; ... s.set(0)`。 |

## 备注

当 `str` 变量刚声明而未初始化时，所有数据成员均为 0。

要获取 `str` 变量的字符串长度，使用其 **len** 属性。

对 `str` 变量执行各种操作时，其数据成员会自动管理。不应手动修改它们，但在以下两种情况下可以修改：

1. 可以修改 **flags** 以在对 `str` 变量执行多个操作时提高性能。
2. 如果想从 `str` 变量中“窃取”字符串缓冲区，可将 **lpstr** 设置为 0。要释放窃取的内存，使用 [q_free](../User/IDP_QMDLL.md#q_free)。

在 C++ 中，`str` 定义类似于：

```cpp
class str
{
public:
    LPSTR lpstr;
    int len, nc;
    BYTE flags;
//成员函数
...
};
```

在 QM 中，`str` 定义类似于：

```
class str lpstr'lpstr len nc byte'flags
```

## 示例

```cpp
str s = "string"
int i = s.len
 // 现在 i 是 6
s.flags = 1
 // 现在 s 的缓冲区可以增长，但不会缩小
```