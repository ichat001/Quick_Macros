# QM 宏代码语法

QM 宏文本由一系列语句组成。通常，一个语句是一行代码，执行某些操作或声明某些标识符。示例：

```qm
lef+ 10 200 "Notepad"
lef
int a b c
a = b * 100
Func b 1
a = Func(b 1)
```

- 第一和第二条语句是**宏命令**，包含以下部分：
  - `lef` 是命令**关键字**。
  - `+` 是**选项**。
  - `10`、`200` 和 `"Notepad"` 是**参数**，即命令或函数的参数的实际值。
- 第三条语句声明了 [变量](IDH_VARIABLES.md) `a`、`b` 和 `c`。
- 第四条语句将 [表达式](IDP_EXPRESSION.md) `b*100` 赋值给变量 `a`。
- 第五条语句调用 [函数](IDH_FUNCTIONS.md) `Func`，传递参数 `b` 和 `1`。
- 最后一条语句调用函数 `Func`，并将其返回值赋值给变量 `a`。

`10`、`200`、`100` 和 `1` 是 [数值常量](IDP_CONSTANT.md)。  
`"Notepad"` 是**字符串常量**。  
`=` 和 `*` 是 [运算符](IDH_OPERATORS.md)。

语句的各部分必须用空格分隔（命令/选项除外）。在带有运算符的语句（如示例 4）中，空格可以省略。分隔参数时，也可以使用逗号（`,`）。

参数列表必须用括号括起来（如示例 6），但如果函数名位于语句开头（如示例 1 和 5），则不需要括号。对于括号括起来的参数，` (` 必须紧跟函数名和选项字符（如果有）。

行首的某些字符具有特殊含义：

- 空格、`;`、`/` 或 `\` 会禁用该行，可用于注释。可以通过右键单击选择栏来轻松启用/禁用一行（或多行）。语句后的注释使用 `;;`。
- 制表符或逗号用于流程控制语句（如 `if`、`rep` 等）。示例：

```qm
 if a is less than 10, left-click, else exit ;; 如果 a 小于 10，左键点击，否则退出
if a<10
    lef
    a + 1 ;; 增加 a 的值
else ret
```

单行可以包含多个由分号（`;`）分隔的语句。在以命令/函数名开头且参数括在括号中（或空括号）的语句后，分号是可选的。在 `else`、`err` 和 `case` 后，分号也是可选的。示例：

```qm
lef+ 10 100 Notepad; lef; int a; a = b + 100; Func(a b); b = Func(a b)
rep() if(b>a) b=Func(a b); else break
```

## 本帮助文件中使用的语法描述

灰色符号的含义如下：

| 语法 | 含义 |
|------|------|
| `[a]` | `a` 是可选的。 |
| `a\|b` | `a` 或 `b`。 |
| `a&b` | `a` 和/或 `b`。 |
| `(a b)\|(c d)` | `a b` 或 `c d`。 |
| `(space)a` | `a` 前必须有空格或分号。 |
| `(tab)a` | `a` 前必须有制表符或逗号。 |
| `...` | 更多参数或语句。 |
| `int a` | `a` 是函数，返回 `int` 类型的值。 |

语法描述示例：

```qm
lef[+|-] [x y] [window] [client]
```

在此示例中，所有参数都括在 `[]` 中，表示可以使用 0、1、2、3 或 4 个参数。  
`[+|-]` 表示可以选择使用选项字符 `+` 或 `-`。  
`lef` 关键字位于开头，表示 `lef` 命令不返回值，不能作为函数使用。

基于上述语法描述的实际代码示例：

```qm
lef 10 200 "Notepad"
lef
lef+ 10 200
```