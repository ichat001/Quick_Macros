# 触发器：文件

文件触发器在指定文件夹中的文件被添加、移除、重命名或修改时启动宏。通过 [Properties](IDH_PROPERTIES.md) 对话框分配此触发器。

## 功能

QM 监控指定文件夹的变化，文件夹可以是本地或网络文件夹/驱动器。

### 文件过滤
- 默认监控文件夹内所有文件。
- 使用 **Include files** 和/或 **Exclude files** 字段过滤文件，支持：
  - 单一文件名：如 `test.txt`。
  - 文件名模式：使用 [通配符 * 和 ?](IDP_WILDCARD.md)，如 `*.txt|*.ini`（监控所有 `.txt` 和 `.ini` 文件）。
  - 多个文件名/模式：用 `|` 分隔。
  - 相对路径：如 `subfolder\test.txt`（包含 `\` 时视为相对路径）。

#### 注意
- 某些情况下，QM 可能接收短文件名（如 `C:\PROGRA~1\SOMEFI~1.TXT` 而非 `C:\Program Files\Some File.txt`），取决于操作文件的程序。
- QM 2.2.0 起，添加和修改事件会将短文件名转换为长文件名；移除和重命名事件无法转换（文件已不存在）。
- 为确保触发器可靠，建议：
  - 使用扩展名（如 `*.txt`）。
  - 使用文件名部分（如 `some*.txt`）。
  - 同时指定长短文件名（如 `some file.txt|somefi~1.txt`）。

### 触发事件
在 **Properties** 对话框的列表框中选择触发宏的事件：
- **Added**：文件创建、移动或复制到监控文件夹。
- **Removed**：文件删除或移出。
- **Name changed**：文件重命名。
- **Modified**：文件时间、属性、大小或安全属性的任何变化（如内容变化导致修改时间更新）。**注意**：最后访问时间精度低，仅选择 **Time Accessed** 可能不会每次触发。

### 网络和可移动驱动器
- QM 自动在网络或可移动驱动器可用/不可用时启动/停止监控。
- 重复的“Modified”事件合并为单一事件。

## 触发器信息

宏可通过 [function](IDP_FUNCTION.md) 语句接收触发器信息（关闭 **Properties** 对话框时需确认插入）：

```qm
\function event $name [$newname]
```

- **event**：
  - 1：添加
  - 2：移除
  - 4：重命名
  - 8：修改
- **name**：文件名（包含路径）。
- **newname**：重命名事件中的新文件名（包含路径），其他事件为空。