# 触发器：Shell 菜单

## 概述

将宏添加到 Windows 的 Shell 上下文菜单中。上下文菜单是在文件夹窗口或桌面上右键点击文件时显示的弹出菜单。可以使用属性对话框分配此触发器。在[便携式 QM](IDP_PORTABLE.md)中不可用。

## 功能说明

当点击菜单项时，宏会运行。宏通过[函数](IDP_FUNCTION.md)语句接收触发信息：

```qm
  \
function $files
```

- **files**：文件路径。如果选择了多个文件，则为路径列表。

## 配置项

### 标签 (Label)

菜单项的标签。要将菜单项添加到子菜单，使用类似 `Submenu\Macro` 的路径。子菜单会自动创建，或者可以手动创建（见下文）。

- 单个 `&` 字符会使后续字符显示下划线。使用 `&&` 表示 `&` 字符。
- **QM 2.3.5**：单连字符 (`-`) 标签创建分隔线。

其他字段为可选。

### 包含、文件类型 (Include, File Types)

指定显示菜单项的文件类型。默认情况下，宏会添加到除文件夹外的所有文件的上下文菜单。要仅对特定文件类型显示，输入一个或多个扩展名，用空格分隔，例如 `txt doc rtf`。对于无扩展名的文件，使用 `<noextension>`。

- **QM 2.3.5**：也适用于驱动器，类似于文件夹。如果仅需驱动器，在“Folders”字段中使用 `?:\`。如果仅需文件夹，使用 `?:\` 并选中“Not”。

- **QM 2.3.5**：可以设置为在桌面或文件夹背景上右键点击时显示菜单项（而非文件上）。宏将接收文件夹的完整路径。

### 文件夹 (Folders)

多行列表，指定添加或不添加菜单项的文件夹。菜单项也会在子文件夹中显示。

- **QM 2.3.5**：支持[通配符](IDP_WILDCARD.md)。此时会比较所选文件的完整路径，而不仅仅是其父文件夹。

### 图像文件 (Image file)

菜单项的图标文件，例如 `$my qm$\copy.ico`。可以是 ico、bmp 或其他文件类型。可以指定图标索引，例如 `icons.dll,4`。避免使用过多可执行文件中的图标，因为提取速度较慢。

### 描述 (Description)

在状态栏显示的文本。

### 子菜单 (Submenu)

如果选中，将创建打开子菜单的菜单项。宏可以为空。如果需要为子菜单指定文件类型、图标或其他属性，请使用此选项，因为无法为自动创建的子菜单分配属性。

## 注意事项

- **菜单项数量限制**：在 Windows XP 上，菜单项数量限制约为 150 个。
- **QM 2.3.5**：触发字符串现以 `$sm` 开头，此前为 `^Shell_menu`。QM 在启动时自动转换。此触发器类型此前作为用户定义触发器实现。
- **QM 2.3.5**：移除按字母顺序排序。现在菜单项按 QM 启动时的顺序排列。
- **QM 2.3.5**：图标不再禁用菜单主题。