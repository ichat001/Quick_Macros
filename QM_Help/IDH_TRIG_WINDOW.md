# 触发器：窗口

## 概述

当指定的窗口出现、消失、被激活等时触发宏的执行。

## 配置方法

使用[属性对话框](IDH_PROPERTIES.md)分配此触发器。可以使用拖放工具填充窗口名称/类字段。在拖放时，可以右键单击将窗口置于底部，或按 Ctrl+Shift+右键将子窗口置于底部。

## 配置项

- **窗口类**：应始终指定窗口类。如果未指定，QM 会忽略某些窗口，例如无标题的窗口。

- **控件（子窗口）**：可以指定窗口中控件的文本或类。暂不支持可访问对象（例如网页中的对象）。

- **窗口样式**：可以指定[窗口样式](IDP_WINDOWSTYLES.md)，可以是数字值、`p`（弹出窗口）或 `m`（非弹出窗口）。

- **窗口名称和控件文本**：可以是部分匹配，必须区分大小写。如果为空，则匹配任何内容。

- **“Use *”选项**：如果选中，窗口名称和控件文本必须是完整的或使用[通配符](IDP_MATCHW.md)`*`和`?`。例如：
  - 要匹配以“ - Notepad”结尾的窗口名称，选中“Use *”并输入“* - Notepad”。
  - 要精确匹配窗口名称“Notepad”，选中“Use *”并输入“Notepad”。
  - 字符串“*”匹配无名称的窗口。

- **正则表达式**：在窗口名称字段中，可以使用[正则表达式](IDP_PCRE.md)，首字符必须为`$`。例如：
  - `$Word.*\.(?i)rtf$` 匹配包含“Word”且以“.rtf”或“.RTF”结尾的窗口名称（`$`表示使用正则表达式，`.*`表示任意字符，`\.`表示字面点，`(?i)`设置大小写不敏感，末尾`$`表示窗口名称结尾）。
  - `$(Notepad|Calc)` 匹配窗口名称为“Notepad”或“Calc”的窗口。
  - 使用正则表达式时，“Use *”选项不应用于窗口名称。

- **类名称**：必须是完整匹配，但可以包含通配符（QM 2.3.4 起），不受“Use *”选项影响。如果为空，则匹配任何类。

- **触发条件**：
  - **Created & active**：窗口创建（首次出现）并激活时触发。
  - **Created & visible**：窗口显示但未激活时触发。
  - **Activated**：窗口每次激活时触发，可用于工具栏（不会在同一窗口上创建相同工具栏的多个实例）。
  - **Name changed**：窗口名称更改且匹配指定名称时触发。

- **“When idle”选项**：如果选中，宏仅在窗口不忙且准备好接收用户输入时启动。但某些窗口可能始终忙碌（占用 CPU），导致宏不运行。

- **多触发器**：多个项目可以具有相同的“窗口”触发器。例如，一个窗口可以有多个工具栏。

## 触发信息

窗口触发的宏通过 `_command` 变量接收窗口句柄。可以通过以下方式获取：
- `val(_command)`
- `TriggerWindow`

## 注意事项

- **“destroyed”触发器**：在 64 位窗口上不可靠。如果在选项 -> 触发器 -> 低级钩子中选中“Other”，也可能不可靠。建议使用获取窗口句柄并等待其销毁的函数。示例：

```qm
 触发器：窗口创建
int hwnd=TriggerWindow
wait 0 -WC hwnd
out "窗口已销毁"
```

## 另见

- [属性对话框](IDH_PROPERTIES.md)