# 工具栏属性

[工具栏](IDH_TOOLBAR.md) 具有动态和静态两种属性设置。

## 动态属性

动态属性可在工具栏运行时更改，自动保存到当前主 [QM 文件](IDH_QML.md)：

- **位置**：右键拖动工具栏。
- **大小**：拖动工具栏边缘调整。
- **其他属性**：通过 [右键菜单](IDH_TOOLBARMENU.md) 设置。

## 静态属性

静态属性在 **Properties** 对话框或工具栏文本首行编辑，保存于工具栏文本。若指定了位置、大小或右键菜单设置，则优先使用静态属性而非动态属性。

### 语法

```qm
/option1 [parameters] [/option2 [parameters] ...]
```

- 以空格或分号分隔，选项以 `/` 开头，每个选项可带 1-2 个参数。
- 未使用的参数可省略或用 `""`。
- 数字参数支持简单整数、命名常量、全局变量、函数、{code} 及带运算符的表达式（含空格或 `/` 的表达式需用括号括起来）。
- 示例（工具栏文本首行）：

```qm
/col 0x80C0FF /hcol "" 0xFF /style WS_CAPTION|WS_SYSMENU|WS_MINIMIZEBOX 0
```

- **{code}**：在创建工具栏时于 QM 主线程作为函数执行，需返回数值（使用 [ret](IDP_RET.md)）。代码或用户定义函数中，工具栏拥有者窗口句柄为 `val(_command)`。
- 示例：

```qm
/mov 200 {ret GetClientTop(val(_command))-20}
/mov 200 TB_ClientY-20
```

- 使用 `mov0`、`siz0`、`ssiz0`、`set0` 仅在首次创建或重置后应用。

## 可用选项

1. **设置工具栏位置**

   ```qm
   /mov x y
   ```

   - `x`, `y`：工具栏位置（像素），可为 `xm`、`ym`（工具栏位于鼠标指针下方）。
   - 坐标相对于拥有者窗口或屏幕的选定角落（取决于 **Coordinates** 设置，另见 `/client`）。
   - 使用 `mov0` 仅首次应用。
   - 示例：

   ```qm
   /mov 200 0
   /mov xm ym+100
   /mov 200 -23 /client
   ```

2. **设置工具栏尺寸**

   ```qm
   /siz width height
   ```

   - 使用 `siz0` 仅首次应用。

3. **设置收缩状态尺寸**

   ```qm
   /ssiz width height
   ```

   - 使用 `ssiz0` 仅首次应用。

4. **设置图标大小**

   ```qm
   /isiz width height
   ```

   - 默认 16x16。若省略 `height`，与 `width` 相同。若 `width` 大于 `height`，文本置于图标下方。

5. **设置按钮最大/最小尺寸**

   ```qm
   /bsiz maxwidth minwidth
   ```

   - QM 2.2.1：支持所有样式，新增 `minwidth`。

6. **设置 [右键菜单](IDH_TOOLBARMENU.md) 初始值**

   ```qm
   /set flags mask
   ```

   - **flags**：[标志](IDP_FLAGS.md)：

     | 值 | 描述 |
     |----|------|
     | 1 | 随拥有者窗口移动或调整大小 |
     | 2 | 显示按钮文本 |
     | 4 | 点击时激活拥有者窗口 |
     | 8 | 自动收缩 |
     | 16 | 等宽按钮 |
     | 32 | 无调整大小边框 |
     | 64 | 始终显示工具提示（即使显示文本） |
     | 128 | 垂直工具栏（换行符为水平） |
     | 0x000 | 坐标：左上 |
     | 0x100 | 坐标：右上 |
     | 0x200 | 坐标：左下 |
     | 0x300 | 坐标：右下 |
     | 0x400 | 坐标：自动选择最近角落 |
     | 0x1000 | 在所有虚拟桌面显示 |
     | 0x2000 | 快速图标（使用图标缓存） |
     | 0x4000 (QM 2.2.0) | 1 像素边框 |
     | 0x8000 (QM 2.2.1) | 3D 按钮 |
     | 0x10000 (QM 2.3.1) | 拖放文件时直接打开，不显示菜单 |
     | 0x20000 (QM 2.3.3) | 全屏窗口激活时隐藏 |
     | 0x40000 (QM 2.3.3) | 置于其他始终置顶窗口（如任务栏）之上 |

   - **mask**：仅更改 `mask` 中为 1 的标志位，首次应用所有标志（忽略 `mask`）。
   - 示例：

     ```qm
     /set 1|2|8|0x400
     ```

   - 使用 `set0` 仅首次应用。

7. **设置工具栏窗口样式**

   ```qm
   /style st exst
   ```

   - `st`, `exst`：窗口样式和扩展样式，支持样式常量名，参考 [MSDN](IDP_MSDN.md)。
   - 示例：

     ```qm
     /style (WS_CAPTION | WS_SYSMENU)
     ```

8. **设置背景和文本颜色**

   ```qm
   /col color textcolor
   ```

   - `color`, `textcolor`：0xBBGGRR 格式的 [颜色](IDP_COLOR.md)，值 1-31 为系统颜色。

9. **设置高亮项背景和文本颜色**

   ```qm
   /hcol color textcolor
   ```

   - 设置高亮颜色会禁用 Windows 主题（视觉样式），工具栏外观可能不同。
   - 不适用于 3D 按钮。

10. **设置透明度**

    ```qm
    /transp opacity color
    ```

    - `opacity`：0（完全透明）到 255（完全不透明）。
    - `color`：指定完全透明的颜色（对鼠标也透明），可选。
    - 在 Vista 及以上版本，高亮按钮可能因渐变色与透明色匹配而失真，可尝试用 `/col` 更改背景色。

11. **设置背景图像**

    ```qm
    /bmp "file"
    ```

    - 支持 bmp、gif、jpg，QM 2.3.4 起支持 png。
    - 示例：

      ```qm
      /bmp "$my qm$\images\b1.bmp"
      ```

12. **玻璃效果**

    ```qm
    /glass
    ```

    - QM 2.2.0：半透明工具栏，不兼容 `/bmp`、透明颜色和高亮颜色（使用 `/glass` 时忽略这些）。需启用 Windows Aero 主题。

13. **设置字体**

    ```qm
    /font XXXX
    ```

    - QM 2.2.0：可在 **Properties** 设置字体，不适用于 Vista 及以上版本的 3D 按钮。

14. **锁定工具栏**

    ```qm
    /lock flags
    ```

    - **flags**：[标志](IDP_FLAGS.md)：

      | 值 | 描述 |
      |----|------|
      | 1 | 隐藏右键菜单 |
      | 2 | 禁用移动 |
      | 4 | 禁用调整大小 |
      | 8 | 禁用修改（禁用拖放及右键菜单前三项，即使未加密或非只读文件夹/文件） |
      | 16 | 禁用右键菜单的“关闭”项 |
      | 128 | 仅对共享文件（[s] 文件夹）中的工具栏应用锁定 |

    - 若省略 `flags`，应用除 128 外的所有标志。

15. **相对于客户区坐标**

    ```qm
    /client
    ```

    - QM 2.4.3：`mov`/`mov0` 指定的位置相对于拥有者窗口客户区或无拥有者时的桌面工作区。

16. **设置 [钩子函数](IDH_EXTOOLBAR.md)**